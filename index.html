<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¬Ø¯ÙˆÙ„ ÙˆÙ…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø§Ø¡</title>
<style>
  :root {
      --primary-color: #00796B;
      --secondary-color: #8BC34A;
      --accent-color: #FFC107;
      --background-light: #F9FBE7;
      --background-medium: #DCEDC8;
      --text-dark: #212121;
      --text-light: #fff;
      --card-bg: #fff;
      --past-color: #B71C1C;
      --warning-color: #FF5722;
      --success-color: #4CAF50;
      --info-color: #2196F3;
  }
  
  body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      margin: 0;
      padding: 10px;
      color: var(--text-dark);
      line-height: 1.6;
  }
  
  .section-container {
      max-width: 900px;
      margin: 20px auto;
      padding: 20px;
      border-radius: 16px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.1);
      background-color: var(--card-bg);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  
  .section-container:hover {
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      transform: translateY(-2px);
  }
  
  h1, h2 {
      text-align: center;
      margin-bottom: 25px;
      color: var(--primary-color);
      font-weight: 700;
  }
  
  h1 {
      font-size: 28px;
      padding-bottom: 10px;
      border-bottom: 3px solid var(--secondary-color);
      display: inline-block;
      text-shadow: 0 1px 2px rgba(0,0,0,0.1);
  }

  .tank-container {
      position: relative;
      width: 180px;
      margin: 30px auto;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 6px 15px rgba(0,0,0,0.2);
  }
  
  .tank-image {
      width: 100%;
      display: block;
      border-radius: 12px;
      filter: brightness(1.05);
  }
  
  .water-level {
      position: absolute;
      bottom: 0;
      width: 100%;
      height: 0%;
      background: linear-gradient(to top, rgba(33,150,243,0.9), rgba(33,150,243,0.6));
      border-radius: 0 0 12px 12px;
      transition: height 0.8s cubic-bezier(0.34, 1.56, 0.64, 1);
      z-index: 2;
  }

  /* Ø®Ø· Ø³ÙŠØ§Ø³Ø© 34% Ù…Ø¹ ØªÙˆØ¶ÙŠØ­ Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø­Ø¨Ø³ */
  .policy-line-34 {
      position: absolute;
      width: 100%;
      height: 4px;
      background-color: var(--warning-color);
      z-index: 10;
      top: 66%;
      box-shadow: 0 0 8px rgba(255, 87, 34, 0.8);
      animation: blink 2s infinite;
  }
  
  @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
  }
  
  .policy-line-34::after {
      content: "34% - Ø¥ÙŠÙ‚Ø§Ù Ø§Ù„Ù…Ø­Ø¨Ø³ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹";
      position: absolute;
      right: -15px;
      top: -45px;
      background: var(--warning-color);
      color: white;
      padding: 6px 12px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: bold;
      white-space: nowrap;
      box-shadow: 0 3px 8px rgba(0,0,0,0.2);
      text-align: center;
      line-height: 1.4;
      z-index: 20;
  }
  
 

  /* Ø£Ù†Ù…Ø§Ø· Ù„ÙˆØ­Ø© Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø§Ø¡ */
  .advanced-water-display {
      animation: fadeIn 0.6s ease;
  }
  
  @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
  }
  
  .water-stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      gap: 20px;
      margin: 30px 0;
  }
  
  .stat-card {
      background: linear-gradient(145deg, #ffffff, #f0f0f0);
      padding: 20px;
      border-radius: 12px;
      text-align: center;
      border-left: 5px solid var(--primary-color);
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
  }
  
  .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: linear-gradient(to right, transparent, rgba(255,255,255,0.3), transparent);
      transform: translateX(-100%);
  }
  
  .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 20px rgba(0,0,0,0.15);
  }
  
  .stat-card:hover::before {
      animation: shimmer 1.5s;
  }
  
  @keyframes shimmer {
      100% { transform: translateX(100%); }
  }
  
  .stat-value {
      font-size: 1.8em;
      font-weight: 800;
      color: var(--primary-color);
      margin-bottom: 5px;
      text-shadow: 0 1px 1px rgba(0,0,0,0.1);
  }
  
  .stat-label {
      font-size: 0.95em;
      color: #666;
      margin-top: 8px;
      font-weight: 600;
  }
  
  .water-controls {
      display: flex;
      gap: 15px;
      margin-top: 25px;
  }
  
  .water-controls button {
      flex: 1;
      padding: 14px;
      font-size: 16px;
      border: none;
      border-radius: 10px;
      background: linear-gradient(to right, var(--primary-color), #00695C);
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 10px rgba(0,121,107,0.3);
  }
  
  .water-controls button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(0,121,107,0.4);
      background: linear-gradient(to right, #00695C, #004D40);
  }
  
  .water-controls button:active {
      transform: translateY(1px);
      box-shadow: 0 2px 5px rgba(0,121,107,0.3);
  }

  /* Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³Ù‚Ø§ÙŠØ© */
  .person-box {
      text-align: center;
      margin: 20px 0;
      padding: 20px;
      border-radius: 12px;
      background: linear-gradient(135deg, var(--background-medium), #C5E1A5);
      font-size: 22px;
      font-weight: bold;
      box-shadow: 0 5px 15px rgba(139,195,74,0.3);
      border: 2px dashed var(--secondary-color);
  }
  
  .person-name {
      color: var(--primary-color);
      text-shadow: 0 1px 2px rgba(0,0,0,0.1);
  }
  
  .countdown-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 25px;
  }
  
  .countdown-circle {
      position: relative;
      width: 140px;
      height: 140px;
      border-radius: 50%;
      background: conic-gradient(var(--primary-color) 0%, #e0e0e0 0%);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 15px;
      box-shadow: 0 8px 20px rgba(0, 121, 107, 0.3);
      transition: all 0.3s ease;
  }
  
  .countdown-circle:hover {
      transform: scale(1.05);
      box-shadow: 0 10px 25px rgba(0, 121, 107, 0.4);
  }
  
  .countdown-circle::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 120px;
      height: 120px;
      background: #fff;
      border-radius: 50%;
      box-shadow: inset 0 3px 8px rgba(0,0,0,0.1);
  }
  
  #timer-text {
      position: relative;
      font-size: 24px;
      font-weight: bold;
      color: var(--primary-color);
      z-index: 1;
      text-shadow: 0 1px 1px rgba(0,0,0,0.1);
  }
  
  .countdown-label {
      font-size: 16px;
      color: var(--text-dark);
      margin-top: -8px;
      font-weight: bold;
      background: rgba(139,195,74,0.1);
      padding: 5px 15px;
      border-radius: 20px;
  }
  
  table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0;
      margin: 20px 0;
      font-size: 14px;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 6px 15px rgba(0,0,0,0.1);
  }
  
  th, td {
      padding: 14px 12px;
      border: 1px solid #E0E0E0;
      text-align: center;
      transition: background-color 0.2s;
  }
  
  th {
      background: linear-gradient(to bottom, var(--primary-color), #00695C);
      color: var(--text-light);
      font-weight: 700;
      font-size: 15px;
  }
  
  tr:nth-child(even) {
      background-color: #F9F9F9;
  }
  
  tr:hover {
      background-color: #F0F7FF;
  }
  
  tr.selected {
      background: linear-gradient(to right, var(--accent-color), #FFB300);
      font-weight: bold;
      color: #5D4037;
      box-shadow: inset 0 0 10px rgba(255,193,7,0.3);
  }
  
  tr.past {
      color: var(--past-color);
      background-color: #FFEBEE;
      text-decoration: line-through;
  }
  
  tr.emergency {
      background: linear-gradient(to right, #FFECB3, #FFE082);
      font-weight: bold;
      color: #FF8F00;
      box-shadow: inset 0 0 10px rgba(255,193,7,0.3);
  }
  
  .detail-btn {
      background: linear-gradient(to bottom, var(--primary-color), #00695C);
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      cursor: pointer;
      font-size: 13px;
      margin-top: 5px;
      font-weight: 600;
      transition: all 0.3s ease;
      box-shadow: 0 3px 8px rgba(0,121,107,0.3);
  }
  
  .detail-btn:hover {
      background: linear-gradient(to bottom, #00695C, #004D40);
      transform: translateY(-2px);
      box-shadow: 0 5px 12px rgba(0,121,107,0.4);
  }
  
  #detailsModal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      justify-content: center;
      align-items: center;
      z-index: 1000;
      backdrop-filter: blur(3px);
  }
  
  #detailsModalContent {
      background: white;
      padding: 30px;
      border-radius: 16px;
      max-width: 90vw;
      width: 500px;
      text-align: right;
      position: relative;
      box-shadow: 0 15px 40px rgba(0,0,0,0.3);
      max-height: 85vh;
      overflow-y: auto;
      animation: modalFadeIn 0.4s ease;
  }
  
  @keyframes modalFadeIn {
      from { opacity: 0; transform: scale(0.9); }
      to { opacity: 1; transform: scale(1); }
  }
  
  #closeModal {
      position: absolute;
      top: 15px;
      left: 20px;
      cursor: pointer;
      font-size: 28px;
      font-weight: bold;
      color: #555;
      transition: color 0.2s;
  }
  
  #closeModal:hover {
      color: var(--warning-color);
  }
  
  .modal-row {
      display: flex;
      flex-direction: column;
      margin-bottom: 15px;
      border-bottom: 1px solid #eee;
      padding-bottom: 12px;
  }
  
  .modal-label {
      font-weight: 700;
      color: var(--primary-color);
      font-size: 16px;
      margin-bottom: 8px;
  }
  
  .modal-value {
      flex: 1;
      text-align: right;
      font-size: 16px;
      padding: 10px 15px;
      border-radius: 8px;
      background: #f9f9f9;
      border: 1px solid #e0e0e0;
  }
  
  /* ØªÙˆØ¶ÙŠØ­ Ø¥Ø¶Ø§ÙÙŠ Ø£Ø³ÙÙ„ Ø§Ù„Ø®Ø²Ø§Ù† */
  .policy-notice {
      text-align: center;
      margin-top: 15px;
      padding: 12px;
      background: linear-gradient(to right, #FFF3E0, #FFECB3);
      border-radius: 10px;
      border-right: 4px solid var(--warning-color);
      font-size: 14px;
      color: #5D4037;
      box-shadow: 0 3px 10px rgba(255,87,34,0.1);
  }
  
  .policy-notice strong {
      color: var(--warning-color);
  }
  
  /* Ø²Ø± Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ */
  .add-reminder-btn {
      display: block;
      width: 100%;
      margin-top: 20px;
      padding: 14px;
      background: linear-gradient(to right, var(--info-color), #1976D2);
      color: white;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(33,150,243,0.3);
  }
  
  .add-reminder-btn:hover {
      background: linear-gradient(to right, #1976D2, #0D47A1);
      transform: translateY(-2px);
      box-shadow: 0 6px 18px rgba(33,150,243,0.4);
  }
  
  .add-reminder-btn:active {
      transform: translateY(1px);
      box-shadow: 0 2px 8px rgba(33,150,243,0.3);
  }
  
  .add-reminder-btn i {
      margin-left: 8px;
  }
  
  /* Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯ */
  .new-site-link {
      border: 2px solid var(--warning-color);
      padding: 15px;
      border-radius: 10px;
      background-color: #FFF3E0;
      color: #D84315;
      font-weight: bold;
      font-size: 16px;
      text-align: center;
      margin: 20px auto;
      max-width: 900px;
      box-shadow: 0 4px 12px rgba(255,87,34,0.1);
  }
  
  .new-site-link a {
      display: inline-block;
      background: linear-gradient(to right, #0d6efd, #0b5ed7);
      color: #fff;
      padding: 15px 30px;
      border-radius: 12px;
      font-weight: bold;
      font-size: 1.2em;
      text-decoration: none;
      box-shadow: 0 6px 15px rgba(13,110,253,0.3);
      transition: all 0.3s ease;
      margin-top: 10px;
  }
  
  .new-site-link a:hover {
      background: linear-gradient(to right, #0b5ed7, #0a58ca);
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(13,110,253,0.4);
  }
  
  .new-site-link a:active {
      transform: translateY(1px);
      box-shadow: 0 3px 10px rgba(13,110,253,0.3);
  }
  
  /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ù„Ù„Ù‡ÙˆØ§ØªÙ */
  @media (max-width: 768px) {
      .section-container {
          padding: 15px;
          margin: 10px auto;
      }
      
      .water-stats {
          grid-template-columns: repeat(2, 1fr);
          gap: 12px;
      }
      
      .stat-card {
          padding: 15px;
      }
      
      .stat-value {
          font-size: 1.5em;
      }
      
      table {
          font-size: 12px;
      }
      
      th, td {
          padding: 10px 8px;
      }
      
      .countdown-circle {
          width: 120px;
          height: 120px;
      }
      
      .countdown-circle::before {
          width: 100px;
          height: 100px;
      }
      
      #timer-text {
          font-size: 20px;
      }
  }
  
  @media (max-width: 480px) {
      .water-stats {
          grid-template-columns: 1fr;
      }
      
      .water-controls {
          flex-direction: column;
      }
      
      .person-box {
          font-size: 18px;
          padding: 15px;
      }
  }
  
  /* Ø±Ø³Ø§Ù„Ø© Ù…Ø¤Ù‚ØªØ© */
  .temp-message {
      position: fixed;
      top: 20px;
      right: 20px;
      background: linear-gradient(to right, var(--warning-color), #E64A19);
      color: white;
      padding: 15px 25px;
      border-radius: 10px;
      box-shadow: 0 5px 20px rgba(0,0,0,0.2);
      z-index: 10000;
      animation: slideInRight 0.5s ease, fadeOut 0.5s ease 2.5s;
      max-width: 300px;
      font-weight: bold;
      text-align: center;
  }
  
  @keyframes slideInRight {
      from { transform: translateX(100%); opacity: 0; }
      to { transform: translateX(0); opacity: 1; }
  }
  
  @keyframes fadeOut {
      from { opacity: 1; }
      to { opacity: 0; }
  }
</style>
</head>
<body>

<!-- Ø±Ø§Ø¨Ø· Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¬Ø¯ÙŠØ¯ -->
<div class="new-site-link">

  <br><br>

</div>

<!-- Ù‚Ø³Ù… Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø§Ø¡ (Ø³ÙŠØªÙ… Ø¥Ø¸Ù‡Ø§Ø±Ù‡ ÙÙ‚Ø· Ù„Ù„Ø£Ø´Ø®Ø§Øµ Ø§Ù„Ù…ØµØ±Ø­ Ù„Ù‡Ù…) -->
<div class="section-container" id="waterLevelSection" style="display: none;">
  <div class="advanced-water-display">
      <h2>ğŸ“Š Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø§Ø¡ Ø§Ù„Ø­Ø§Ù„ÙŠ</h2>
      
      <div class="tank-container">
        <img src="https://i.postimg.cc/fyPGh4kx/Chat-GPT-Image-Oct-19-2025-10-26-24-PM.png" alt="Ø®Ø²Ø§Ù† Ù…Ø§Ø¡" class="tank-image">
       
        <div </div>
        <div class="water-level" id="waterLevel"></div>
      </div>
      

      </div>
      
      <div class="water-stats">
        <div class="stat-card">
          <div class="stat-value" id="percentDisplay">0%</div>
          <div class="stat-label">Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ©</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="litersDisplay">0 Ù„ØªØ±</div>
          <div class="stat-label">Ø§Ù„Ø­Ø¬Ù… Ø§Ù„Ø­Ø§Ù„ÙŠ</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="signalStrength">0</div>
          <div class="stat-label">Ù‚ÙˆØ© Ø§Ù„Ø¥Ø´Ø§Ø±Ø©</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="distanceDisplay">0 Ø³Ù…</div>
          <div class="stat-label">Ø§Ù„Ù…Ø³Ø§ÙØ©</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="lastUpdateTime">--:--:--</div>
          <div class="stat-label">Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«</div>
        </div>
        <div class="stat-card">
          <div class="stat-value" id="totalCapacity">0 Ù„ØªØ±</div>
          <div class="stat-label">Ø§Ù„Ø³Ø¹Ø© Ø§Ù„ÙƒÙ„ÙŠØ©</div>
        </div>
      </div>
      
      <div class="water-controls">
        <button class="btn-primary" onclick="refreshWaterData()">ğŸ”„ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
      </div>
  </div>
</div>

<!-- Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… -->
<div class="section-container">
  <div class="person-box">
    Ø³ÙÙ‚Ù’ÙˆÙÙ‡Ù Ø§Ù„ÙŠÙˆÙ…: <span id="currentPerson" class="person-name">Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ø¯ÙŠØ¯...</span>
  </div>
  <div class="countdown-container">
    <div class="countdown-circle">
      <span id="timer-text">--:--:--</span>
    </div>
    <div class="countdown-label">Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</div>
  </div>
</div>

<div class="section-container">
  <table id="scheduleTable">
    <thead>
      <tr>
        <th>Ø§Ù„ÙŠÙˆÙ…</th>
        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
        <th>Ø§Ù„Ø§Ø³Ù…</th>
        <th>Ù…Ù„Ø§Ø­Ø¸Ø©</th>
      </tr>
    </thead>
    <tbody id="scheduleBody"></tbody>
  </table>
</div>

<div class="section-container">
  <h2>Ø§Ù„Ù…Ø¤Ù‡Ù„ÙˆÙ† Ù„Ø£ÙŠØ§Ù… Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</h2>
  <p>Ø§Ù„Ø£Ø´Ø®Ø§Øµ Ø§Ù„Ù…Ø°ÙƒÙˆØ±ÙˆÙ† ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø£Ø¯Ù†Ø§Ù‡ ÙÙ‚Ø· Ù‡Ù… Ø§Ù„Ù…Ø¤Ù‡Ù„ÙˆÙ† Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø£ÙŠØ§Ù… Ø§Ù„Ø·ÙˆØ§Ø±Ø¦.</p>
  <table>
    <thead>
      <tr>
        <th>#</th>
        <th>Ø§Ù„Ø§Ø³Ù…</th>
        <th>Ù…Ø¯Ø© Ø§Ù„Ø³Ù‚ÙŠØ§</th>
      </tr>
    </thead>
    <tbody>
      <tr><td>1</td><td>ÙŠØ­ÙŠÙ‰ Ø¬Ø§Ø¨Ø±</td><td>1 Ø³Ø§Ø¹Ø©</td></tr>
      <tr><td>2</td><td>Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡ Ù…Ø­Ù…Ø¯ Ø¬Ø§Ø¨Ø±</td><td>1 Ø³Ø§Ø¹Ø©</td></tr>
      <tr><td>3</td><td>Ø®Ø²Ø§Ù†Ø§Øª Ø§Ù„Ø¬ÙŠØ±Ø§Ù† ÙÙŠ Ø§Ù„Ø­ÙŠ</td><td>1 Ø³Ø§Ø¹Ø©</td></tr>
    </tbody>
  </table>
  <div class="policy">
    <br>
    <ul>
      <li>Ù…Ø¯Ø© Ø§Ù„Ø³Ù‚ÙŠØ§ ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ Ù„Ø§ ØªØªØ¬Ø§ÙˆØ² <strong>Ø³Ø§Ø¹Ø© ÙˆØ§Ø­Ø¯Ø© ÙÙ‚Ø·</strong></li>
      <li>Ù„Ø§ ÙŠØªÙ… Ù…Ù†Ø­ Ø£ÙƒØ«Ø± Ù…Ù† ÙŠÙˆÙ… Ø·ÙˆØ§Ø±Ø¦ Ø¥Ù„Ø§ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø§Ø¬Ø© Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØ©</li>
      <li>Ø£ÙŠ ØªØ¬Ø§ÙˆØ² Ø£Ùˆ ØªÙ„Ø§Ø¹Ø¨ ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¹Ø§Ø¯Ù‡ Ù…Ø¨Ø§Ø´Ø±Ø© ÙˆØ¯ÙˆÙ† ØªÙ†Ø¨ÙŠÙ‡</li>
    </ul>
  </div>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø¹Ø¯Ù„Ø© -->
<div id="detailsModal">
  <div id="detailsModalContent">
    <span id="closeModal">&times;</span>
    <div class="modal-header">
      <h2>ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø³ÙÙ‚Ù’ÙŠÙØ©</h2>
    </div>
    
    <div class="modal-row">
      <span class="modal-label">Ø§Ø³Ù… Ø§Ù„Ø´Ø®Øµ:</span>
      <span class="modal-value" id="modalPerson"></span>
    </div>
    
    <div class="modal-row">
      <span class="modal-label">Ø§Ù„ØªØ§Ø±ÙŠØ®:</span>
      <span class="modal-value" id="modalDate"></span>
    </div>
    
    <div class="modal-row">
      <span class="modal-label">ÙˆÙ‚Øª Ø¨Ø¯Ø¡ Ø§Ù„Ø³ÙÙ‚Ù’ÙŠÙØ©:</span>
      <span class="modal-value" id="modalStart"></span>
    </div>
    
    <div class="modal-row">
      <span class="modal-label">ÙˆÙ‚Øª Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø³ÙÙ‚Ù’ÙŠÙØ©:</span>
      <span class="modal-value" id="modalEnd"></span>
    </div>
    
    <div class="modal-row">
      <span class="modal-label">Ø­Ø§Ù„Ø© Ø§Ù„Ø³ÙÙ‚Ù’ÙŠÙØ©:</span>
      <span class="modal-value" id="modalStatus"></span>
    </div>
    
    <div class="modal-row">
      <span class="modal-label">Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</span>
      <span class="modal-value" id="modalNote"></span>
    </div>
    
    <!-- Ø²Ø± Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ù„ØªÙ‚ÙˆÙŠÙ… Ø¬ÙˆØ¬Ù„ -->
    <button class="add-reminder-btn" id="addReminderBtn">
      <i>ğŸ“…</i> Ø£Ø¶Ù ØªÙ†Ø¨ÙŠÙ‡ ÙÙŠ ØªÙ‚ÙˆÙŠÙ… Ø¬ÙˆØ¬Ù„ (10 Ø¯Ù‚Ø§Ø¦Ù‚ Ù‚Ø¨Ù„)
    </button>
  </div>
</div>

<script>
// ============================================================================
// Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ­ÙƒÙ… ÙÙŠ Ø¥Ø¸Ù‡Ø§Ø± Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø§Ø¡ Ø­Ø³Ø¨ Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ø­Ø§Ù„ÙŠ
// ============================================================================

// Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…ØµØ±Ø­ Ù„Ù‡Ù… Ø¨Ø±Ø¤ÙŠØ© Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø§Ø¡ (ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ù„Ù‡Ù…)
const AUTHORIZED_FOR_WATER_LEVEL = [
    "Ù…Ø­Ù…Ø¯ Ø¹Ù…Ø¶Ø§Ù†",
    "Ù…ÙØ±Ø­ Ø¬Ø§Ø¨Ø±", 
    "ÙŠØ­ÙŠÙ‰ Ø¨Ù† Ø¬Ø§Ø¨Ø±",
    "Ø¹Ù„ÙŠ ÙŠØ­ÙŠÙ‰",
    "Ø£Ø­Ù…Ø¯ Ù…ÙØ±Ø­",
    "ÙŠØ­ÙŠÙ‰ Ù…ÙØ±Ø­",
    "Ù…Ø­Ù…Ø¯ Ø¬Ø¨Ø§Ø±",
    "Ø¬Ø§Ø¨Ø± ÙŠØ­ÙŠÙ‰",
    "ÙŠÙˆÙ… Ø·ÙˆØ§Ø±ÙŠ",
    "Ø­Ø³ÙŠÙ† ÙŠØ­ÙŠÙ‰"
];

// Ø¯Ø§Ù„Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø´Ø®Øµ Ù…ØµØ±Ø­Ø§Ù‹ Ù„Ù‡ Ø¨Ø±Ø¤ÙŠØ© Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø§Ø¡
function isAuthorizedForWaterLevel(personName) {
    if (!personName) return false;
    return AUTHORIZED_FOR_WATER_LEVEL.some(name => 
        name.toLowerCase() === personName.toLowerCase()
    );
}

// Ø¯Ø§Ù„Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙˆØ¹Ø±Ø¶ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø§Ø¡
function checkWaterLevelAccess() {
    const currentPersonElement = document.getElementById('currentPerson');
    const currentPerson = currentPersonElement ? currentPersonElement.textContent.trim() : '';
    const waterSection = document.getElementById('waterLevelSection');
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ø­Ø§Ù„ÙŠ Ù…Ù† Ø§Ù„Ù…ØµØ±Ø­ Ù„Ù‡Ù…
    const isAuthorized = isAuthorizedForWaterLevel(currentPerson);
    
    if (isAuthorized) {
        // Ø¥Ø¸Ù‡Ø§Ø± Ù‚Ø³Ù… Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø§Ø¡
        waterSection.style.display = 'block';
        
        // ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø§Ø¡ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…Ø®ÙÙŠØ© Ø³Ø§Ø¨Ù‚Ø§Ù‹
        if (typeof refreshWaterData === 'function') {
            refreshWaterData();
        }
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨
        if (currentPerson !== "Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ø¯ÙŠØ¯..." && currentPerson !== "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³ÙÙ‚Ù’ÙŠÙØ© Ø§Ù„Ø¢Ù†") {
            showTemporaryMessage(`ğŸ”“ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø§Ø¡ Ù…ØªØ§Ø­ Ù„Ùƒ Ø§Ù„Ø¢Ù†`, 3000);
        }
    } else {
        // Ø¥Ø®ÙØ§Ø¡ Ù‚Ø³Ù… Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø§Ø¡
        waterSection.style.display = 'none';
        
        // Ø¥Ø¸Ù‡Ø§Ø± Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ØºÙŠØ± Ø§Ù„Ù…ØµØ±Ø­ Ù„Ù‡Ù…
        if (currentPerson && currentPerson !== "Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ø¯ÙŠØ¯..." && currentPerson !== "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³ÙÙ‚Ù’ÙŠÙØ© Ø§Ù„Ø¢Ù†") {
            showTemporaryMessage(`ğŸ”’ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø§Ø¡ ØºÙŠØ± Ù…ØªØ§Ø­. ÙŠØ¸Ù‡Ø± ÙÙ‚Ø· Ù„Ù„Ø£Ø´Ø®Ø§Øµ Ø§Ù„Ù…ØµØ±Ø­ Ù„Ù‡Ù…`, 4000);
        }
    }
}

// ============================================================================
// ØªØ­Ø³ÙŠÙ†Ø§Øª Ø¬Ù…Ø§Ù„ÙŠØ© ÙˆØ¥Ø¶Ø§ÙØ© Ø®Ø§ØµÙŠØ© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ù„ØªÙ‚ÙˆÙŠÙ… Ø¬ÙˆØ¬Ù„
// ============================================================================

// Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø®Ø²Ø§Ù†
const TANK_CONFIG = {
  height: 355,
  diameter: 370,
  shape: 'cylindrical'
};

let totalTankVolume = 0;

// ØªÙ‡ÙŠØ¦Ø© Ø¹Ø±Ø¶ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø§Ø¡
function initializeWaterDisplay() {
  totalTankVolume = calculateTankVolume();
  document.getElementById('totalCapacity').textContent = Math.round(totalTankVolume).toLocaleString() + ' Ù„ØªØ±';
  fetchWaterData();
  setInterval(fetchWaterData, 30000);
}

// Ø­Ø³Ø§Ø¨ Ø³Ø¹Ø© Ø§Ù„Ø®Ø²Ø§Ù†
function calculateTankVolume() {
  const radius = TANK_CONFIG.diameter / 2;
  if (TANK_CONFIG.shape === 'cylindrical') {
    const volumeCm3 = Math.PI * Math.pow(radius, 2) * TANK_CONFIG.height;
    return volumeCm3 / 1000;
  }
  return 0;
}

// Ø­Ø³Ø§Ø¨ ÙƒÙ…ÙŠØ© Ø§Ù„Ù…Ø§Ø¡
function calculateWaterVolume(distance) {
  const waterHeight = TANK_CONFIG.height - distance;
  if (waterHeight <= 0) return 0;
  if (waterHeight > TANK_CONFIG.height) return totalTankVolume;
  const radius = TANK_CONFIG.diameter / 2;
  if (TANK_CONFIG.shape === 'cylindrical') {
    const volumeCm3 = Math.PI * Math.pow(radius, 2) * waterHeight;
    return volumeCm3 / 1000;
  }
  return 0;
}

// Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø§Ø¡ Ù…Ù† Google Apps Script
async function fetchWaterData() {
  try {
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxppOlRtEYur9rESbp-9VWqm7JYxPe1TvAv4RzQCtlHsimI76xcKH_93AzwCEuhj8AK/exec';
    
    const response = await fetch(`${SCRIPT_URL}?operation=getLatest&t=${Date.now()}`);
    
    if (response.ok) {
      const data = await response.json();
      if (data.status === 'success') {
        updateWaterDisplay(data.data);
      } else {
        updateWaterDisplay(generateMockData());
      }
    } else {
      updateWaterDisplay(generateMockData());
    }
  } catch (error) {
    console.error('Error fetching water data:', error);
    updateWaterDisplay(generateMockData());
  }
}

// ØªÙˆÙ„ÙŠØ¯ Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ©
function generateMockData() {
  const distance = Math.floor(Math.random() * 200) + 100;
  const volume = calculateWaterVolume(distance);
  const level = (volume / totalTankVolume) * 100;
  
  return {
    level: level,
    distance: distance,
    volume: volume,
    strength: Math.floor(Math.random() * 500) + 100,
    timestamp: new Date().toISOString(),
    device: 'Ù†Ø¸Ø§Ù… Ù…Ø±Ø§Ù‚Ø¨Ø© Ø§Ù„Ù…Ø§Ø¡'
  };
}

// ØªØ­Ø¯ÙŠØ« Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø§Ø¡
function updateWaterDisplay(data) {
  let distance, level, volume;
  
  if (data.distance && data.distance > 0) {
    distance = parseFloat(data.distance);
    volume = calculateWaterVolume(distance);
    level = (volume / totalTankVolume) * 100;
  } else if (data.level && data.level > 0) {
    level = parseFloat(data.level);
    volume = (level / 100) * totalTankVolume;
    distance = TANK_CONFIG.height - (level / 100) * TANK_CONFIG.height;
  } else {
    distance = Math.floor(Math.random() * 200) + 100;
    volume = calculateWaterVolume(distance);
    level = (volume / totalTankVolume) * 100;
  }
  
  // ØªØ­Ø¯ÙŠØ« ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
  document.getElementById('waterLevel').style.height = level + '%';
  document.getElementById('percentDisplay').textContent = level.toFixed(1) + '%';
  document.getElementById('litersDisplay').textContent = Math.round(volume).toLocaleString() + ' Ù„ØªØ±';
  
  document.getElementById('signalStrength').textContent = data.strength || '0';
  document.getElementById('distanceDisplay').textContent = distance.toFixed(1) + ' Ø³Ù…';
  document.getElementById('lastUpdateTime').textContent = new Date().toLocaleTimeString('ar-SA');
}

// ØªØ­Ø¯ÙŠØ« ÙŠØ¯ÙˆÙŠ Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø§Ø¡
function refreshWaterData() {
  fetchWaterData();
}

// ============================================================================
// Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø£ØµÙ„ÙŠ Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³Ù‚Ø§ÙŠØ© Ù…Ø¹ Ø¥Ø¶Ø§ÙØ© Ø®Ø§ØµÙŠØ© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
// ============================================================================

const people = [
    "Ù…ÙØ±Ø­ Ø¹Ù…Ø¶Ø§Ù†", "Ù…Ø­Ù…Ø¯ Ø¹Ù…Ø¶Ø§Ù†", "Ù…ÙØ±Ø­ Ø¬Ø§Ø¨Ø±", "ÙŠØ­ÙŠÙ‰ Ø¨Ù† Ø¬Ø§Ø¨Ø±", "Ø¹Ù„ÙŠ ÙŠØ­ÙŠÙ‰",
    "Ø£Ø­Ù…Ø¯ Ù…ÙØ±Ø­", "ÙŠØ­ÙŠÙ‰ Ù…ÙØ±Ø­", "Ø¬Ø§Ø¨Ø± ÙŠØ­ÙŠÙ‰", "Ø­Ø³ÙŠÙ† ÙŠØ­ÙŠÙ‰", "Ù…Ø­Ù…Ø¯ Ù…ÙØ±Ø­",
    "Ø¹Ù„ÙŠ Ø¬Ø§Ø¨Ø±", "Ù…Ø­Ù…Ø¯ ÙŠØ­ÙŠÙ‰", "Ø¹Ù„ÙŠ Ø£Ø­Ù…Ø¯", "Ù…Ø­Ù…Ø¯ Ø£Ø­Ù…Ø¯", "Ù…Ø§Ø·Ø± Ø£Ø­Ù…Ø¯ Ø¹Ù„ÙŠ",
    "Ù‚Ø§Ø³Ù… Ø¬Ø§Ø¨Ø±", "Ø¬Ø§Ø¨Ø± Ø­Ø³ÙŠÙ†", "Ù…ÙØ±Ø­ Ø£Ø­Ù…Ø¯", "Ø¹Ø¨Ø¯Ø§Ù„Ø±Ø­Ù…Ù† Ø³Ø§Ù„Ù…", "Ø¬Ø§Ø¨Ø± Ø£Ø­Ù…Ø¯",
    "Ø£Ø­Ù…Ø¯ Ø¨Ù† ÙŠØ­ÙŠÙ‰", "Ø£Ø­Ù…Ø¯ Ø´ÙˆØ¹Ø§Ù†", "Ù…Ø­Ù…Ø¯ Ø¬Ø¨Ø§Ø±", "home",
];
let emergencyDays = [5, 10, 15, 20, 25, 30];
let scheduleTable = [];
let currentSchedule = null;
let nextSchedule = null;
let currentModalData = null;

// Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„ÙŠÙˆÙ… ÙŠÙˆÙ… Ø·ÙˆØ§Ø±Ø¦
function isEmergencyDay(personName) {
    return personName === "ÙŠÙˆÙ… Ø·ÙˆØ§Ø±ÙŠ" || personName === "ÙŠÙˆÙ… Ø·ÙˆØ§Ø±Ø¦";
}

function getDayName(date) { 
    const days = ['Ø§Ù„Ø£Ø­Ø¯', 'Ø§Ù„Ø¥Ø«Ù†ÙŠÙ†', 'Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡', 'Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡', 'Ø§Ù„Ø®Ù…ÙŠØ³', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ø³Ø¨Øª']; 
    return days[date.getDay()]; 
}

function formatDateFull(date) {
    const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
    return date.toLocaleDateString('ar-EG', options);
}

function formatDateTimeFull(date) {
    const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', hour12: true };
    return date.toLocaleDateString('ar-EG', options);
}

// Ø¯Ø§Ù„Ø© Ù…Ø­Ø³Ù†Ø© Ù„ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ Ù…Ø¹ Ø¨Ø¯Ø¡ ÙƒÙ„ Ø´Ù‡Ø± Ø¨Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ø£ÙˆÙ„
function generateSchedule() {
    const today = new Date();
    const year = today.getFullYear();
    const month = today.getMonth();
    
    // Ø­Ø³Ø§Ø¨ Ø¹Ø¯Ø¯ Ø£ÙŠØ§Ù… Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹
    const daysInMonth = new Date(year, month + 1, 0).getDate();
    const tbody = document.getElementById('scheduleBody');
    tbody.innerHTML = '';
    
    // Ø¨Ø¯Ø¡ ÙƒÙ„ Ø´Ù‡Ø± Ø¬Ø¯ÙŠØ¯ Ø¨Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ø£ÙˆÙ„ (Ù…ÙØ±Ø­ Ø¹Ù…Ø¶Ø§Ù†)
    let dayCounter = 0;
    
    // Ø§Ø³ØªØ¨Ø¹Ø§Ø¯ "home" Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø´Ù‡Ø± 28 ÙŠÙˆÙ…Ù‹Ø§ ÙÙ‚Ø·
    let currentPeople = [...people];
    if (daysInMonth === 28) {
        currentPeople = currentPeople.filter(person => person !== "home");
        console.log("ØªÙ… Ø§Ø³ØªØ¨Ø¹Ø§Ø¯ 'home' Ù…Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù„Ø£Ù† Ø§Ù„Ø´Ù‡Ø± 28 ÙŠÙˆÙ…Ù‹Ø§");
    }
    
    // Ø§Ø³ØªØ¨Ø¹Ø§Ø¯ ÙŠÙˆÙ… Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ ÙÙŠ Ø§Ù„ÙŠÙˆÙ… 30 Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø´Ù‡Ø± 30 ÙŠÙˆÙ…Ù‹Ø§ ÙˆÙˆØ¶Ø¹Ù‡ ÙÙŠ Ø§Ù„ÙŠÙˆÙ… 29
    let currentEmergencyDays = [...emergencyDays];
    if (daysInMonth === 30) {
        // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ÙŠÙˆÙ… 30 Ù…Ù† Ø£ÙŠØ§Ù… Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ ÙˆØ¥Ø¶Ø§ÙØ© Ø§Ù„ÙŠÙˆÙ… 29 Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§
        currentEmergencyDays = currentEmergencyDays.filter(day => day !== 30);
        if (!currentEmergencyDays.includes(29)) {
            currentEmergencyDays.push(29);
            currentEmergencyDays.sort((a, b) => a - b); // Ù„ÙØ±Ø² Ø§Ù„Ø£ÙŠØ§Ù…
        }
        console.log("ØªÙ… Ù†Ù‚Ù„ ÙŠÙˆÙ… Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ Ù…Ù† Ø§Ù„ÙŠÙˆÙ… 30 Ø¥Ù„Ù‰ Ø§Ù„ÙŠÙˆÙ… 29 Ù„Ø£Ù† Ø§Ù„Ø´Ù‡Ø± 30 ÙŠÙˆÙ…Ù‹Ø§");
    }
    
    scheduleTable = [];
    
    // Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ Ù…Ø¹ Ø¨Ø¯Ø¡ ÙƒÙ„ Ø´Ù‡Ø± Ø¨Ø§Ù„Ø´Ø®Øµ Ø§Ù„Ø£ÙˆÙ„
    for (let i = 0; i < daysInMonth; i++) {
        const date = new Date(year, month, i + 1);
        let start = new Date(year, month, i, 17, 0, 0);
        let end = new Date(year, month, i, 17, 0, 0);
        end.setDate(end.getDate() + 1);
        
        let personName = '', noteText = '', isEmergency = false;

        if (currentEmergencyDays.includes(i + 1)) {
            personName = 'ÙŠÙˆÙ… Ø·ÙˆØ§Ø±ÙŠ';
            noteText = '';
            isEmergency = true;
        } else {
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù†ÙØ³ Ø§Ù„ØªØ±ØªÙŠØ¨ Ø¯Ø§Ø¦Ù…Ø§Ù‹ Ø¨ØºØ¶ Ø§Ù„Ù†Ø¸Ø± Ø¹Ù† Ø·ÙˆÙ„ Ø§Ù„Ø´Ù‡Ø±ØŒ Ù…Ø¹ Ø¨Ø¯Ø¡ ÙƒÙ„ Ø´Ù‡Ø± Ù…Ù† Ø§Ù„Ø£ÙˆÙ„
            const personIndex = dayCounter % currentPeople.length;
            personName = currentPeople[personIndex];
            noteText = '';
            dayCounter++;
        }
        
        scheduleTable.push({ date, personName, start, end, note: noteText, isEmergency });
    }

    // Ø¹Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙÙŠ Ø§Ù„ØµÙØ­Ø©
    scheduleTable.forEach(entry => {
        const row = document.createElement('tr');
        const nowDate = new Date();
        
        if (nowDate >= entry.start && nowDate < entry.end) {
            row.classList.add('selected');
            currentSchedule = entry;
        }
        if (nowDate > entry.end) {
            row.classList.add('past');
        }
        if (entry.isEmergency) {
            row.classList.add('emergency');
        }
        
        row.innerHTML = `
            <td>${getDayName(entry.date)}</td>
            <td>${entry.date.toLocaleDateString('ar-EG', { month: 'long', day: 'numeric' })}</td>
            <td>${entry.personName}</td>
            <td>
                ${entry.note}
                <button class="detail-btn" onclick="showDetails('${entry.personName}', '${entry.start.toISOString()}', '${entry.end.toISOString()}', '${entry.note}', ${entry.isEmergency})">ØªÙØ§ØµÙŠÙ„</button>
            </td>`;
        
        tbody.appendChild(row);
    });
    
    updateCurrentSchedule();
}

function updateCurrentSchedule() {
    const now = new Date();
    const cs = scheduleTable.find(e => now >= e.start && now < e.end);
    currentSchedule = cs || null;
    
    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„ØªØ§Ù„ÙŠ Ø¨Ø´ÙƒÙ„ Ø£ÙƒØ«Ø± Ø¯Ù‚Ø©
    nextSchedule = null;
    
    // Ø£ÙˆÙ„Ø§Ù‹: Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„ØªØ§Ù„ÙŠ ÙÙŠ Ù†ÙØ³ Ø§Ù„ÙŠÙˆÙ…
    if (cs) {
        // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ù…ÙˆØ¹Ø¯ Ø­Ø§Ù„ÙŠØŒ ÙØ¥Ù† Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„ØªØ§Ù„ÙŠ Ù‡Ùˆ Ù†ÙØ³ Ø§Ù„ÙˆÙ‚Øª ÙÙŠ Ø§Ù„ÙŠÙˆÙ… Ø§Ù„ØªØ§Ù„ÙŠ
        const tomorrow = new Date(cs.end);
        tomorrow.setDate(tomorrow.getDate() + 1);
        nextSchedule = scheduleTable.find(e => e.date.getDate() === tomorrow.getDate());
    }
    
    // Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø§Ù„ØªØ§Ù„ÙŠØŒ Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£ÙˆÙ„ Ù…ÙˆØ¹Ø¯ ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„
    if (!nextSchedule && scheduleTable.length > 0) {
        for (let i = 0; i < scheduleTable.length; i++) {
            if (now < scheduleTable[i].start) {
                nextSchedule = scheduleTable[i];
                break;
            }
        }
    }
    
    // Ø¥Ø°Ø§ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù…ÙˆØ¹Ø¯ ØªØ§Ù„ÙŠØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø£ÙˆÙ„ Ù…ÙˆØ¹Ø¯ ÙÙŠ Ø§Ù„Ø´Ù‡Ø± Ø§Ù„Ù‚Ø§Ø¯Ù…
    if (!nextSchedule && scheduleTable.length > 0) {
        nextSchedule = scheduleTable[0];
    }
    
    document.getElementById('currentPerson').textContent = cs ? cs.personName : "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø³ÙÙ‚Ù’ÙŠÙØ© Ø§Ù„Ø¢Ù†";
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø¹Ø±Ø¶ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø§Ø¡ Ø¹Ù†Ø¯ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„
    checkWaterLevelAccess();
}

// Ø¯Ø§Ù„Ø© Ù…Ø­Ø³Ù†Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ
function updateRemainingTime() {
    const now = new Date();
    
    if (!nextSchedule) {
        document.getElementById('timer-text').textContent = "--:--:--";
        document.querySelector('.countdown-circle').style.background = `conic-gradient(var(--primary-color) 0%, #e0e0e0 0%)`;
        return;
    }
    
    const diff = nextSchedule.start - now;
    
    if (diff <= 0) {
        // Ø¥Ø°Ø§ Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„ÙˆÙ‚ØªØŒ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¬Ø¯ÙˆÙ„
        document.getElementById('timer-text').textContent = "00:00:00";
        document.querySelector('.countdown-circle').style.background = `conic-gradient(var(--primary-color) 100%, #e0e0e0 100%)`;
        
        // Ø¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ø¨Ø¹Ø¯ Ø«Ø§Ù†ÙŠØ©
        setTimeout(() => {
            generateSchedule();
        }, 1000);
        return;
    }
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ø§Ø¹Ø§Øª ÙˆØ§Ù„Ø¯Ù‚Ø§Ø¦Ù‚ ÙˆØ§Ù„Ø«ÙˆØ§Ù†ÙŠ
    const hours = Math.floor(diff / (1000 * 60 * 60));
    const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
    const seconds = Math.floor((diff % (1000 * 60)) / 1000);
    
    // ØªØ­Ø¯ÙŠØ« Ù†Øµ Ø§Ù„Ù…Ø¤Ù‚Øª
    document.getElementById('timer-text').textContent = 
        `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
    
    // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ© Ù„Ù„Ø¯Ø§Ø¦Ø±Ø© (Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù…Ù† 24 Ø³Ø§Ø¹Ø©)
    const hoursDiff = diff / (1000 * 60 * 60);
    const percentage = Math.max(0, Math.min(100, (24 - hoursDiff) / 24 * 100));
    
    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¯Ø§Ø¦Ø±Ø©
    document.querySelector('.countdown-circle').style.background = 
        `conic-gradient(var(--primary-color) ${percentage}%, #e0e0e0 ${percentage}%)`;
}

// Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø¥Ù„Ù‰ ØªÙ‚ÙˆÙŠÙ… Ø¬ÙˆØ¬Ù„
function addGoogleCalendarReminder(eventDetails) {
    // ÙˆÙ‚Øª Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ (10 Ø¯Ù‚Ø§Ø¦Ù‚ Ù‚Ø¨Ù„ Ø¨Ø¯Ø¡ Ø§Ù„Ø³Ù‚Ø§ÙŠØ©)
    const reminderTime = new Date(eventDetails.startTime);
    reminderTime.setMinutes(reminderTime.getMinutes() - 10);
    
    // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªÙˆØ§Ø±ÙŠØ® Ù„Ø±Ø§Ø¨Ø· Ø¬ÙˆØ¬Ù„ ÙƒØ§Ù„Ù†Ø¯Ø±
    const formatDateForGoogle = (date) => {
        return date.toISOString().replace(/-|:|\.\d+/g, '');
    };
    
    // Ø¥Ù†Ø´Ø§Ø¡ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø­Ø¯Ø«
    const eventTitle = `Ø³ÙÙ‚Ù’ÙŠÙØ©: ${eventDetails.personName}`;
    const eventDescription = `Ø³ÙÙ‚Ù’ÙŠÙØ© Ø§Ù„Ù…Ø§Ø¡ - ${eventDetails.personName}\n\n` +
                            `ØªØ§Ø±ÙŠØ®: ${eventDetails.dateString}\n` +
                            `ÙˆÙ‚Øª Ø§Ù„Ø¨Ø¯Ø¡: ${eventDetails.startTimeString}\n` +
                            `ÙˆÙ‚Øª Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡: ${eventDetails.endTimeString}\n` +
                            `Ø§Ù„Ø­Ø§Ù„Ø©: ${eventDetails.status}\n` +
                            `Ù…Ù„Ø§Ø­Ø¸Ø§Øª: ${eventDetails.note || "Ù„Ø§ ØªÙˆØ¬Ø¯"}\n\n` +
                            `(ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ù…Ù† Ù…ÙˆÙ‚Ø¹ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³Ù‚Ø§ÙŠØ©)`;
    
    // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ø¬ÙˆØ¬Ù„ ÙƒØ§Ù„Ù†Ø¯Ø±
    const googleCalendarUrl = 'https://calendar.google.com/calendar/render?' +
        'action=TEMPLATE&' +
        'text=' + encodeURIComponent(eventTitle) + '&' +
        'details=' + encodeURIComponent(eventDescription) + '&' +
        'dates=' + formatDateForGoogle(eventDetails.startTime) + '/' + formatDateForGoogle(eventDetails.endTime) + '&' +
        'reminder=10&' + // ØªÙ†Ø¨ÙŠÙ‡ Ù‚Ø¨Ù„ 10 Ø¯Ù‚Ø§Ø¦Ù‚
        'reminder=1440&' + // ØªÙ†Ø¨ÙŠÙ‡ Ù‚Ø¨Ù„ ÙŠÙˆÙ… ÙˆØ§Ø­Ø¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
        'location=' + encodeURIComponent('Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø³Ù‚Ø§ÙŠØ©') + '&' +
        'trp=false&' +
        'sprop=' + encodeURIComponent('name:Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³Ù‚Ø§ÙŠØ©') + '&' +
        'sprop=name:' + encodeURIComponent(window.location.href);
    
    // ÙØªØ­ Ø§Ù„Ø±Ø§Ø¨Ø· ÙÙŠ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø©
    window.open(googleCalendarUrl, '_blank', 'width=800,height=600');
    
    // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªØ£ÙƒÙŠØ¯
    showTemporaryMessage(`ğŸ“… ØªÙ… ÙØªØ­ ØµÙØ­Ø© Ø¥Ø¶Ø§ÙØ© Ø­Ø¯Ø« Ø¥Ù„Ù‰ ØªÙ‚ÙˆÙŠÙ… Ø¬ÙˆØ¬Ù„`, 4000);
}

function showDetails(name, start, end, note, isEmergency) {
    const startDate = new Date(start);
    const endDate = new Date(end);
    const now = new Date();
    
    document.getElementById('modalPerson').textContent = name;
    document.getElementById('modalDate').textContent = formatDateFull(startDate);
    document.getElementById('modalStart').textContent = formatDateTimeFull(startDate);
    document.getElementById('modalEnd').textContent = formatDateTimeFull(endDate);
    
    let status = '';
    if (now < startDate) {
        status = 'Ù„Ù… ØªØ¨Ø¯Ø£ Ø¨Ø¹Ø¯';
    } else if (now >= startDate && now < endDate) {
        status = 'ÙŠØ³ØªÙ‚ÙŠ Ø§Ù„Ø§Ù†';
    } else {
        status = 'Ø§Ù†ØªÙ‡Øª';
    }
    
    document.getElementById('modalStatus').textContent = status;
    document.getElementById('modalNote').textContent = note || "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª";
    document.getElementById('detailsModal').style.display = 'flex';
    
    // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø§ÙØ°Ø© Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙÙŠ Ø²Ø± Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
    currentModalData = {
        personName: name,
        dateString: formatDateFull(startDate),
        startTimeString: formatDateTimeFull(startDate),
        endTimeString: formatDateTimeFull(endDate),
        startTime: startDate,
        endTime: endDate,
        status: status,
        note: note || "Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù„Ø§Ø­Ø¸Ø§Øª",
        isEmergency: isEmergency
    };
    
    // ØªØ¹ÙŠÙŠÙ† Ø­Ø¯Ø« Ù„Ø²Ø± Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
    document.getElementById('addReminderBtn').onclick = function() {
        if (currentModalData) {
            addGoogleCalendarReminder(currentModalData);
        }
    };
}

// Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù†Ø¨Ø«Ù‚Ø©
document.getElementById('closeModal').onclick = function() {
    document.getElementById('detailsModal').style.display = 'none';
    currentModalData = null;
}

// Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù†Ø§ÙØ°Ø© Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
window.onclick = function(event) {
    const modal = document.getElementById('detailsModal');
    if (event.target == modal) {
        modal.style.display = 'none';
        currentModalData = null;
    }
}

// Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø±Ø³Ø§Ø¦Ù„ Ù…Ø¤Ù‚ØªØ©
function showTemporaryMessage(message, duration = 3000) {
    const messageDiv = document.createElement('div');
    messageDiv.className = 'temp-message';
    messageDiv.textContent = message;
    document.body.appendChild(messageDiv);
    
    setTimeout(() => {
        messageDiv.remove();
    }, duration);
}

// ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
window.onload = function() {
    // ØªÙ‡ÙŠØ¦Ø© Ø¹Ø±Ø¶ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø§Ø¡
    initializeWaterDisplay();
    
    // ØªÙ‡ÙŠØ¦Ø© Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø³Ù‚Ø§ÙŠØ©
    generateSchedule();
    updateRemainingTime();
    setInterval(updateRemainingTime, 1000);
    setInterval(generateSchedule, 60 * 60 * 1000);
    
    // Ø§Ù„ØªØ­Ù‚Ù‚ Ø§Ù„Ø£ÙˆÙ„ÙŠ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ø¹Ø±Ø¶ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ù…Ø§Ø¡
    setTimeout(() => {
        checkWaterLevelAccess();
    }, 500);
}
</script>

</body>
</html>
